language: node_js
node_js: "8"

matrix:
  include:
    - os: linux
      env:
        - PIP='sudo pip'
    - os: osx
before_script:
  - git clone --depth=1 --single-branch --branch develop https://github.com/skycoin/hardware-wallet.git temporalFolder
  - git -C temporalFolder checkout develop
  - git -C temporalFolder submodule init
  - git -C temporalFolder submodule update
  - git -C temporalFolder submodule update --remote
  - sh "./temporalFolder/tiny-firmware/protob/ci-scripts/install-${TRAVIS_OS_NAME}.sh" ;
  # Define env vars for Linux builds
  - if [[ $TRAVIS_OS_NAME == 'linux' ]]; then
    sudo apt-get update;
    sudo apt install libudev-dev;
    sudo apt install libusb-1.0-0-dev;
    sudo apt install libsdl2-dev libsdl2-image-dev;
    ls -l /usr/local/bin/protoc;
    export PATH="/usr/local/bin:$(pwd)/protoc/bin:$PATH";
    echo "PATH=$PATH";
    echo "PIP=$PIP";
    fi
  # Define env vars for osx builds
  # Include paths for brew packages e.g. SDL2
  - if [[ $TRAVIS_OS_NAME == 'osx' ]]; then
    export SDL_INCLUDE="$(brew --prefix sdl2)/include/SDL2" ;
    fi
  - npm install
  - npm run make-protobuf-files
  # Install OS-specific test and build dependencies
  - eval "./temporalFolder/ci-scripts/install-${TRAVIS_OS_NAME}.sh"
  - make clean -C ./temporalFolder
  - make run-emulator -C ./temporalFolder
script:
  - npm run lint
  - npm test
after_script:
  - kill -s KILL $(pgrep emulator)
notifications:
  # https://github.com/kvld/travisci-telegram TravisCI Telegram Bot integration
  webhooks: https://fathomless-fjord-24024.herokuapp.com/notify

